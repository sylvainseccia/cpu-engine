#pragma once

struct TRANSFORM
{
	// Position
	XMFLOAT3 pos;

	// Scaling
	XMFLOAT3 sca;

	// Rotation
	XMFLOAT3 dir;
	XMFLOAT3 right;
	XMFLOAT3 up;
	XMFLOAT4 quat;
	XMFLOAT4X4 rot;

	// World
	XMFLOAT4X4 world;
	
	TRANSFORM();
	void Identity();
	void Update();
	void SetScaling(float scale);
	void SetPosition(float x, float y, float z);
	void Move(float dist);
	void ResetRotation();
	void SetRotation(TRANSFORM& transform);
	void SetYPR(float yaw, float pitch = 0.0f, float roll = 0.0f);
	void AddYPR(float yaw, float pitch = 0.0f, float roll = 0.0f);
	void LookAt(float x, float y, float z);
	void LookTo(float ndx, float ndy, float ndz);
	void LookTo(XMFLOAT3& ndir);
};

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

struct ENTITY
{
	int index;
	int sortedIndex;
	bool dead;
	MESH* pMesh;
	TRANSFORM transform;
	XMFLOAT3 view;
	XMFLOAT3 material;
	float lifetime;
	ui32 tile;
	float radius;
	AABB aabb;
	OBB obb;
	RECTANGLE box;

	ENTITY();
};

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

struct FRUSTUM
{
	XMFLOAT4 planes[6]; // left, right, bottom, top, near, far

	FRUSTUM();
	void FromViewProj(const XMFLOAT4X4& viewProj);
	bool Intersect(const XMFLOAT3& center, float radius);
	XMVECTOR XM_CALLCONV NormalizePlane(FXMVECTOR p);
};

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

struct CAMERA
{
	float fov;
	float near;
	float far;
	XMFLOAT4X4 matView;
	XMFLOAT4X4 matProj;
	XMFLOAT4X4 matViewProj;
	TRANSFORM transform;
	FRUSTUM frustum;

	CAMERA();
	void UpdateProjection(float aspectRatio);
	void Update();
};
