#pragma once

struct VEC3_CMP
{
	bool operator()(const XMFLOAT3& a, const XMFLOAT3& b) const
	{
		const float eps = 0.001f;
		if ( std::abs(a.x-b.x)>eps )
			return a.x<b.x;
		if ( std::abs(a.y-b.y)>eps )
			return a.y<b.y;
		return a.z<(b.z-eps);
	}
};

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

struct VERTEX
{
	XMFLOAT3 pos;
	XMFLOAT3 color;
	XMFLOAT3 normal;

	VERTEX();
	void Identity();
};

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

struct TRIANGLE
{
	VERTEX v[3];

	TRIANGLE();
	void Identity();
};

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

struct RECTANGLE
{
	XMFLOAT2 min;
	XMFLOAT2 max;

	RECTANGLE();
	void Zero();
};

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

struct AABB
{
	XMFLOAT3 min;
	XMFLOAT3 max;

	AABB();
	AABB& operator=(const OBB& obb);
	void Zero();
	bool XM_CALLCONV ToScreen(RECTANGLE& out, FXMMATRIX wvp, float renderWidth, float renderHeight);
};

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

struct OBB
{
	XMFLOAT3 pts[8];

	OBB();
	OBB& operator=(const AABB& aabb);
	void Zero();
	void XM_CALLCONV Transform(FXMMATRIX m);
};

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

struct RAY
{
	XMFLOAT3 pos;
	XMFLOAT3 dir;

	RAY();
	void Identity();
};

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

struct MESH
{
	std::vector<TRIANGLE> triangles;
	float radius;
	AABB aabb;

	MESH();
	void Clear();
	void AddTriangle(XMFLOAT3& a, XMFLOAT3& b, XMFLOAT3& c, XMFLOAT3& color);
	void AddFace(XMFLOAT3& a, XMFLOAT3& b, XMFLOAT3& c, XMFLOAT3& d, XMFLOAT3& color);
	void Optimize();
	void CalculateNormals();
	void CalculateBox();
	void CreateSpaceship();
	void CreateCube();
	void CreateCircle(float radius, int count = 6);
};
