#include "pch.h"

cpu_vinput::cpu_vinput()
{
	pInput = nullptr;
	keys[0] = 0;
	keys[255] = 0;
	Reset();
}

cpu_vinput::~cpu_vinput()
{
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void cpu_vinput::Initialize(cpu_input* pI)
{
	pInput = pI;
}

void cpu_vinput::Reset()
{
	memset(keys+1, 0, 254);
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

bool cpu_vinput::IsKey(int key)
{
	return keys[key]==_DOWN || keys[key]==_PUSH;
}

bool cpu_vinput::IsKeyReleased(int key)
{
	return keys[key]==_UP;
}

bool cpu_vinput::IsKeyPressed(int key)
{
	return keys[key]==_DOWN;
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void cpu_vinput::Update()
{
	for ( int i=1 ; i<255 ; i++ )
	{
		bool state = false;
		if ( pInput->focus )
			state = GetAsyncKeyState(i)<0;

		if ( state )
		{
			switch ( keys[i] )
			{
			case _NONE:
			case _UP:
				keys[i] = _DOWN;
				break;
			case _DOWN:
				keys[i] = _PUSH;
				break;
			}
		}
		else
		{
			switch ( keys[i] )
			{
			case _PUSH:
			case _DOWN:
				keys[i] = _UP;
				break;
			case _UP:
				keys[i] = _NONE;
				break;
			}
		}
	}
}
