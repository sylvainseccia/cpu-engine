#include "pch.h"

cpu_input::cpu_input()
{
}

cpu_input::~cpu_input()
{
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

cpu_input& cpu_input::GetInstance()
{
	static cpu_input* pInput = new cpu_input;
	return *pInput;
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void cpu_input::Initialize()
{
	pWindow = nullptr;
	vi.Initialize(this);
	xi.Initialize(this);

	Reset();

	MapActionForVI(0, VK_SHIFT, VK_LBUTTON);
	MapActionForXI(0, CPU_XINPUT_A);

	MapActionForVI(1, VK_CONTROL, VK_RBUTTON);
	MapActionForXI(1, CPU_XINPUT_B);
}

void cpu_input::Uninitialize()
{
	pWindow = nullptr;
	for ( size_t i=0 ; i<CPU_INPUT_ACTIONS ; i++ )
	{
		mapActionsForVI[i].clear();
		mapActionsForXI[i].clear();
	}
	delete &GetInstance();
}

void cpu_input::SetWindow(cpu_window* pWnd)
{
	pWindow = pWnd;
}

void cpu_input::Reset()
{
	vi.Reset();
	xi.Reset();
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

bool cpu_input::IsAction(int index)
{
	assert( index>=0 && index<CPU_INPUT_ACTIONS );

	for ( size_t i=0 ; i<mapActionsForVI->size() ; i++ )
	{
		if ( vi.IsKey(mapActionsForVI[index][i]) )
			return true;
	}

	for ( size_t i=0 ; i<mapActionsForXI->size() ; i++ )
	{
		if ( xi.IsButton(mapActionsForXI[index][i]) )
			return true;
	}

	return false;
}

bool cpu_input::IsActionPressed(int index)
{
	assert( index>=0 && index<CPU_INPUT_ACTIONS );

	for ( size_t i=0 ; i<mapActionsForVI->size() ; i++ )
	{
		if ( vi.IsKeyPressed(mapActionsForVI[index][i]) )
			return true;
	}

	for ( size_t i=0 ; i<mapActionsForXI->size() ; i++ )
	{
		if ( xi.IsButtonPressed(mapActionsForXI[index][i]) )
			return true;
	}

	return false;
}

bool cpu_input::IsActionReleased(int index)
{
	assert( index>=0 && index<CPU_INPUT_ACTIONS );

	for ( size_t i=0 ; i<mapActionsForVI->size() ; i++ )
	{
		if ( vi.IsKeyReleased(mapActionsForVI[index][i]) )
			return true;
	}

	for ( size_t i=0 ; i<mapActionsForXI->size() ; i++ )
	{
		if ( xi.IsButtonReleased(mapActionsForXI[index][i]) )
			return true;
	}

	return false;
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

bool cpu_input::IsBackPressed()
{
	return vi.IsKeyPressed(VK_ESCAPE) || xi.IsBackPressed();
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

bool cpu_input::IsLeft()
{
	return vi.IsKey(VK_LEFT) || vi.IsKey('A') || vi.IsKey('Q') || xi.IsLeft();
}

bool cpu_input::IsLeftPressed()
{
	return vi.IsKeyPressed(VK_LEFT) || vi.IsKeyPressed('A') || vi.IsKeyPressed('Q') || xi.IsLeftPressed();
}

bool cpu_input::IsLeftReleased()
{
	return vi.IsKeyReleased(VK_LEFT) || vi.IsKeyReleased('A') || vi.IsKeyReleased('Q') || xi.IsLeftReleased();
}

bool cpu_input::IsRight()
{
	return vi.IsKey(VK_RIGHT) || vi.IsKey('D') || xi.IsRight();
}

bool cpu_input::IsRightPressed()
{
	return vi.IsKeyPressed(VK_RIGHT) || vi.IsKeyPressed('D') || xi.IsRightPressed();
}

bool cpu_input::IsRightReleased()
{
	return vi.IsKeyReleased(VK_RIGHT) || vi.IsKeyReleased('D') || xi.IsRightReleased();
}

bool cpu_input::IsUp()
{
	return vi.IsKey(VK_UP) || vi.IsKey('W') || vi.IsKey('Z') || xi.IsUp();
}

bool cpu_input::IsUpPressed()
{
	return vi.IsKeyPressed(VK_UP) || vi.IsKeyPressed('W') || vi.IsKeyPressed('Z') || xi.IsUpPressed();
}

bool cpu_input::IsUpReleased()
{
	return vi.IsKeyReleased(VK_UP) || vi.IsKeyReleased('W') || vi.IsKeyReleased('Z') || xi.IsUpReleased();
}

bool cpu_input::IsDown()
{
	return vi.IsKey(VK_DOWN) || vi.IsKey('S') || xi.IsDown();
}

bool cpu_input::IsDownPressed()
{
	return vi.IsKeyPressed(VK_DOWN) || vi.IsKeyPressed('S') || xi.IsDownPressed();
}

bool cpu_input::IsDownReleased()
{
	return vi.IsKeyReleased(VK_DOWN) || vi.IsKeyReleased('S') || xi.IsDownReleased();
}

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////

void cpu_input::Update()
{
	focus = true;
	if ( pWindow )
		focus = pWindow->HasFocus();

	vi.Update();
	xi.Update();
}
